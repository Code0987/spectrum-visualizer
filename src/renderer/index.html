<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src 'self' file: blob:;"
        />
        <title>Spectrum Visualizer</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div id="app">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 class="logo">
                        <span class="logo-icon">â—‰</span>
                        <span>Spectrum</span>
                    </h1>
                </div>
                <div class="header-center">
                    <div class="audio-controls">
                        <button
                            id="btn-play"
                            class="control-btn"
                            title="Play/Pause"
                        >
                            <svg class="icon play-icon" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            <svg class="icon pause-icon" viewBox="0 0 24 24">
                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                            </svg>
                        </button>
                        <button id="btn-stop" class="control-btn" title="Stop">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M6 6h12v12H6z" />
                            </svg>
                        </button>
                        <div class="volume-control">
                            <svg class="icon volume-icon" viewBox="0 0 24 24">
                                <path
                                    d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
                                />
                            </svg>
                            <input
                                type="range"
                                id="volume-slider"
                                min="0"
                                max="100"
                                value="80"
                                class="slider"
                            />
                        </div>
                        <span id="current-time" class="time-display">0:00</span>
                        <div class="progress-container">
                            <div class="progress-bar" id="progress-bar">
                                <div
                                    class="progress-fill"
                                    id="progress-fill"
                                ></div>
                            </div>
                        </div>
                        <span id="duration" class="time-display">0:00</span>
                    </div>
                </div>
                <div class="header-right">
                    <button id="btn-settings" class="icon-btn" title="Settings">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"
                            />
                        </svg>
                    </button>
                    <button
                        id="btn-fullscreen"
                        class="icon-btn"
                        title="Fullscreen"
                    >
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"
                            />
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Sidebar -->
                <aside class="sidebar" id="sidebar">
                    <div class="sidebar-section">
                        <h3 class="section-title">Audio Source</h3>
                        <div class="source-buttons">
                            <button id="btn-mic" class="source-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path
                                        d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"
                                    />
                                </svg>
                                <span>Microphone</span>
                            </button>
                            <button id="btn-file" class="source-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path
                                        d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
                                    />
                                </svg>
                                <span>Audio File</span>
                            </button>
                        </div>
                        <div id="file-info" class="file-info hidden">
                            <span class="file-name"></span>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="section-title">Visualization</h3>
                        <div class="viz-grid">
                            <button class="viz-btn active" data-viz="bars">
                                <div class="viz-preview bars-preview"></div>
                                <span>Bars</span>
                            </button>
                            <button class="viz-btn" data-viz="waveform">
                                <div class="viz-preview wave-preview"></div>
                                <span>Waveform</span>
                            </button>
                            <button class="viz-btn" data-viz="circular">
                                <div class="viz-preview circular-preview"></div>
                                <span>Circular</span>
                            </button>
                            <button class="viz-btn" data-viz="particles">
                                <div
                                    class="viz-preview particles-preview"
                                ></div>
                                <span>Particles</span>
                            </button>
                            <button class="viz-btn" data-viz="cloud">
                                <div class="viz-preview cloud-preview"></div>
                                <span>Cloud</span>
                            </button>
                            <button class="viz-btn" data-viz="psychedelic">
                                <div
                                    class="viz-preview psychedelic-preview"
                                ></div>
                                <span>Psychedelic</span>
                            </button>
                            <button class="viz-btn" data-viz="3d">
                                <div class="viz-preview terrain-preview"></div>
                                <span>3D Terrain</span>
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="section-title">Color Theme</h3>
                        <div class="theme-grid">
                            <button
                                class="theme-btn active"
                                data-theme="neon"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #ff00ff,
                                        #00ffff
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="fire"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #ff0000,
                                        #ffff00
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="ocean"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #0066ff,
                                        #00ff99
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="sunset"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #ff6b35,
                                        #f7c59f
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="forest"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #2d5a27,
                                        #8bc34a
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="galaxy"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #1a0033,
                                        #9933ff
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="monochrome"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        #333,
                                        #fff
                                    );
                                "
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="rainbow"
                                style="
                                    background: linear-gradient(
                                        135deg,
                                        red,
                                        orange,
                                        yellow,
                                        green,
                                        blue,
                                        purple
                                    );
                                "
                            ></button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <button id="btn-export" class="export-btn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path
                                    d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"
                                />
                            </svg>
                            <span>Export Video</span>
                        </button>
                    </div>
                </aside>

                <!-- Canvas Area -->
                <div class="canvas-container" id="canvas-container">
                    <canvas id="visualizer-canvas"></canvas>
                    <canvas id="three-canvas" class="hidden"></canvas>
                    <div class="drop-zone" id="drop-zone">
                        <div class="drop-content">
                            <svg class="drop-icon" viewBox="0 0 24 24">
                                <path
                                    d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
                                />
                            </svg>
                            <p>Drop audio file here or click to browse</p>
                            <span class="drop-formats"
                                >Supports MP3, WAV, OGG, FLAC, M4A</span
                            >
                        </div>
                    </div>
                </div>
            </main>

            <!-- Settings Panel -->
            <div class="settings-panel" id="settings-panel">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <button id="btn-close-settings" class="close-btn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                            />
                        </svg>
                    </button>
                </div>
                <div class="settings-content">
                    <div class="setting-group">
                        <h3>Audio Analysis</h3>
                        <div class="setting-item">
                            <label>FFT Size</label>
                            <select id="fft-size">
                                <option value="256">256</option>
                                <option value="512">512</option>
                                <option value="1024">1024</option>
                                <option value="2048" selected>2048</option>
                                <option value="4096">4096</option>
                                <option value="8192">8192</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Smoothing</label>
                            <input
                                type="range"
                                id="smoothing"
                                min="0"
                                max="99"
                                value="80"
                            />
                            <span class="value-display" id="smoothing-value"
                                >0.80</span
                            >
                        </div>
                        <div class="setting-item">
                            <label>Sensitivity</label>
                            <input
                                type="range"
                                id="sensitivity"
                                min="50"
                                max="200"
                                value="100"
                            />
                            <span class="value-display" id="sensitivity-value"
                                >100%</span
                            >
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Visualization</h3>
                        <div class="setting-item">
                            <label>Animation Speed</label>
                            <input
                                type="range"
                                id="animation-speed"
                                min="10"
                                max="200"
                                value="100"
                            />
                            <span class="value-display" id="speed-value"
                                >100%</span
                            >
                        </div>
                        <div class="setting-item">
                            <label>Bar Count</label>
                            <input
                                type="range"
                                id="bar-count"
                                min="16"
                                max="256"
                                value="64"
                            />
                            <span class="value-display" id="bar-count-value"
                                >64</span
                            >
                        </div>
                        <div class="setting-item">
                            <label>Bar Spacing</label>
                            <input
                                type="range"
                                id="bar-spacing"
                                min="1"
                                max="10"
                                value="2"
                            />
                            <span class="value-display" id="bar-spacing-value"
                                >2px</span
                            >
                        </div>
                        <div class="setting-item checkbox-item">
                            <label>Mirror Effect</label>
                            <input type="checkbox" id="mirror-effect" />
                        </div>
                        <div class="setting-item checkbox-item">
                            <label>Glow Effect</label>
                            <input type="checkbox" id="glow-effect" checked />
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Background</h3>
                        <div class="setting-item">
                            <label>Background Color</label>
                            <input type="color" id="bg-color" value="#0a0a0f" />
                        </div>
                        <div class="setting-item checkbox-item">
                            <label>Show Gradient Background</label>
                            <input type="checkbox" id="gradient-bg" checked />
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Export Settings</h3>
                        <div class="setting-item">
                            <label>Resolution</label>
                            <select id="export-resolution">
                                <option value="720">720p (1280x720)</option>
                                <option value="1080" selected>
                                    1080p (1920x1080)
                                </option>
                                <option value="1440">2K (2560x1440)</option>
                                <option value="2160">4K (3840x2160)</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Frame Rate</label>
                            <select id="export-fps">
                                <option value="24">24 FPS</option>
                                <option value="30" selected>30 FPS</option>
                                <option value="60">60 FPS</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Format</label>
                            <select id="export-format">
                                <option value="mp4">MP4 (H.264)</option>
                                <option value="webm">WebM (VP9)</option>
                                <option value="gif">GIF</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Modal -->
            <div class="modal" id="export-modal">
                <div class="modal-content">
                    <h2>Exporting Video</h2>
                    <div class="export-progress">
                        <div class="progress-bar-export">
                            <div
                                class="progress-fill-export"
                                id="export-progress-fill"
                            ></div>
                        </div>
                        <span class="progress-text" id="export-progress-text"
                            >0%</span
                        >
                    </div>
                    <p class="export-status" id="export-status">Preparing...</p>
                    <button id="btn-cancel-export" class="cancel-btn">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- Fullscreen Hint -->
            <div class="fullscreen-hint" id="fullscreen-hint">
                Press <kbd>F</kbd> or <kbd>Esc</kbd> to exit fullscreen
            </div>
        </div>

        <script src="../utils/audio-processor.js"></script>
        <script src="../visualizations/base-visualizer.js"></script>
        <script src="../visualizations/bars-visualizer.js"></script>
        <script src="../visualizations/waveform-visualizer.js"></script>
        <script src="../visualizations/circular-visualizer.js"></script>
        <script src="../visualizations/particles-visualizer.js"></script>
        <script src="../visualizations/cloud-visualizer.js"></script>
        <script src="../visualizations/psychedelic-visualizer.js"></script>
        <script src="../visualizations/terrain-visualizer.js"></script>
        <script src="../utils/video-exporter.js"></script>
        <script src="renderer.js"></script>
    </body>
</html>
